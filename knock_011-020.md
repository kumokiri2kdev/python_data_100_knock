# 小売店のデータでデータ加工を行う１０本ノック

## データの読み込み

'uriage_data' に 'csv/uriage.csv' を読み込め。

```python
import pandas as pd

uriage_data = pd.read_csv('csv/uriage.csv')

```

'kokyaku_data' に 'csv/kokyaku_daicho.xlsx' を読み込め。

```python
kokyaku_data = pd.read_excel('csv/kokyaku_daicho.xlsx')
```

## データ種類の列挙
uriage_data の 'item_name' を列挙せよ。

```python
pd.unique(uriage_data.item_name)
```

## データの変換
uriage_data['item_name'] の アルファベットの小文字を大文字に変換せよ。

```python
uriage_data['item_name'] = uriage_data['item_name'].str.upper()
```

uriage_data['item_name'] の スペース（半角・全角）を削除せよ。
```python
uriage_data['item_name'] = uriage_data['item_name'].str.replace('　','')
uriage_data['item_name'] = uriage_data['item_name'].str.replace(' ','')
```

## データのソート
```python
uriage_data.sort_values(by=['item_name'], ascending=True, inplace=True)  
```

## 欠損値の補完
欠損値が含まれる列の有無を確認せよ。

```python
uriage_data.isnull().any(axis=0)
```

欠損値 'item_price' を 同じ 'item_id' をもつデータの 'item_price' で補完せよ。

※ 同じ 'item_id' の 'item_price' は一定の為、最大の値を使用して保管する。

```python
flg_is_null = uriage_data['item_price'].isnull()

for tag in uriage_data.loc[flg_is_null,'item_name'].unique():
    price = uriage_data.loc[(~flg_is_null) & (uriage_data['item_name'] == tag), 'item_price'].max()
    uriage_data['item_price'].loc[(flg_is_null) & (uriage_data['item_name'] == tag)] = price

```

[ToDo] https://note.nkmk.me/python-pandas-setting-with-copy-warning/

## 表記揺れの補正
kokyaku_data の '顧客名' から、半角・全角スペースを取り除け。

```python
pd.unique(kokyaku_data['顧客名'])

kokyaku_data['顧客名'] = kokyaku_data['顧客名'].str.replace('　','')
kokyaku_data['顧客名'] = kokyaku_data['顧客名'].str.replace(' ','')

pd.unique(kokyaku_data['顧客名'])
```
```
array(['須賀ひとみ', '岡田敏也', '芳賀希', '荻野愛', '栗田憲一', '梅沢麻緒', '相原ひとり', '新村丈史',
       '石川まさみ', '小栗正義', '大倉晃司', '那須蒼甫', '清水裕次郎', '榊原しぼり', '高沢美咲', '川島友以乃',
       '唐沢景子', '稲田将也', '秋葉あき', '西脇礼子', '内村まさみ', '進藤瞬', '小口豊', '笹原しぼり',
       '岩佐孝太郎', '河村由樹', '菅原誠治', '榎本薫', '高梨結衣', '鶴岡薫', '藤木一恵', '森岡季衣',
       '田畑正敏', '宇野秀樹', '高原充則', '梅村秀樹', '浅田賢二', '石渡小雁', '吉岡サダヲ', '井口寛治',
       '奥光洋', '佐藤慶二', '東光博', '高田さんま', '合田光', '深田信輔', '島英嗣', '梅津淳子',
       '日比野徹', '熊倉綾', '松田浩正', '楠高史', '岡慶太', '市田寿明', '山西花', '青山鉄洋', '松川綾女',
       '大滝麗奈', '赤木愛梨', '楠哲平', '堀内聡', '八木雅彦', '林勇', '日野夏希', '麻生莉緒', '根岸仁晶',
       '赤木だん吉', '亀井一徳', '横田遥', '野本仁晶', '西原未華子', '五十嵐春樹', '堀江佑', '久保田倫子',
       '金森なつみ', '城戸芳正', '望月真悠子', '井本マサカズ', '米沢仁晶', '本橋直人', '古川信吾', '岩沢那奈',
       '西島知世', '戸塚美幸', '深井照生', '新谷智花', '有馬徹平', '本多フミヤ', '浜田未華子', '牧田玲那',
       '島孝太郎', '石田花', '星野美嘉', '黒谷長利', '深沢ひろ子', '矢部夏空', '立石茜', '手塚雅之',
       '松谷愛子', '中田美智子', '片瀬長利', '石崎幸子', '明石家明', '小川美菜', '田辺光洋', '神原美嘉',
       '岩城徹平', '相川良介', '植村遥', '井川真悠子', '松元翔太', 'さだ千佳子', '島本研二', '影山輝信',
       '浅見広司', '石野仁', '小平陽子', '福本美幸', '中仁晶', '田辺きみまろ', '熊倉明日', '鈴木一哉',
       '杉田将也', '徳重優', '松岡ノブヒコ', '藤広之', '谷本愛梨', '松沢育二', '清水佑', '土屋朝陽',
       '鳥居広司', '福島友也', '堀サンタマリア', '井川里穂', '田崎菜々美', '平田鉄二', '井上桃子', '尾形小雁',
       '沖遥', '矢部美幸', '島袋友以乃', '深井菜々美', '南部慶二', '若杉徹', '矢部惇', '熊井憲史',
       '岡村希', '桑原桃子', '原口俊二', '尾上勝久', '杉下悟志', '志村サダヲ', '山口法子', '大城ケンイチ',
       '新村美月', '河内さとみ', '内田聡', '吉村愛梨', '根岸莉央', '丸山光臣', '石田佑', '根本博明',
       '今茜', '村山知世', '大山咲', '島崎礼子', '松居満', '田上美佐子', '篠山雅功', '外山広司',
       '岩井莉緒', '大崎ヒカル', '矢沢恵梨香', '石田郁恵', '荻野愛菜', '香椎優一', '黄川田博之', '井村俊二',
       '植木沙知絵', '小松隼士', '松村聡', '平賀一哉', '手塚進', '磯野希', '白井俊二', '笹川照生',
       '芦田博之', '大地礼子', '小町瞬', '水野メイサ', '板橋隆', '綾瀬俊介', '和泉直人', '堀北雅彦',
       '唐沢涼', '川上りえ', '小松季衣', '白鳥りえ', '大西隆之介', '福井美希'], dtype=object)
```

## 日付表記の補正（統一）
登録日をの表記を %Y/%m/%d の datetime64 型に統一せよ。

```python
flg_is_serial = kokyaku_data['登録日'].astype('str').str.isdigit()

fromSerial = pd.to_timedelta(kokyaku_data.loc[flg_is_serial, '登録日'].astype('float'), unit='D') + pd.to_datetime('1900/01/01')
fromString = pd.to_datetime(kokyaku_data.loc[~flg_is_serial,'登録日'])

kokyaku_data['登録日'] = pd.concat([fromSerial, fromString])
```

登録日から登録月列を追加せよ。

```python
kokyaku_data['登録月'] = kokyaku_data['登録日'].dt.strftime('%Y/%m')
```

登録日から登録月列を数値で追加せよ。
```python
kokyaku_data['purchase_month'].dt.strftime('%Y%m').astype('int')
```


## グループ化
月ごとの顧客数を計算せよ。

```python
kokyaku_data.groupby(by='登録月')['顧客名'].count()
```

```
登録月
2017/01    15
2017/02    11
2017/03    14
2017/04    15
2017/05    13
2017/06    14
2017/07    17
2018/01    13
2018/02    15
2018/03    17
2018/04     5
2018/05    19
2018/06    13
2018/07    17
2019/04     2
Name: 顧客名, dtype: int64
```

売り上げ月を数値で

## データマージ
uriage_data と kokyaku_data を 顧客名（'customer_name'/'顧客名')をキーに結合せよ。

```python
join_data = pd.merge(uriage_data, kokyaku_data, left_on='customer_name', right_on='顧客名', how='left')

join_data = join_data.drop('customer_name', axis=1)

```

## データのダンプ
join_data から 'purchase_date', 'purchase_month', 'item_name', 'item_price', '顧客名', 'かな', '地域', 'メールアドレス', '登録日' を抜き出して、'out/dump_data.csv' に吐き出せ。

```python
join_data[['purchase_date', 'purchase_month', 'item_name', 'item_price', '顧客名', 'かな', '地域', 'メールアドレス', '登録日']].to_csv('out/dump_data.csv', index=False)
```

## 集計
'purchase_month' を縦軸にし、商品毎の売り上げ個数を集計をせよ。

```python
join_data.pivot_table(index='purchase_month', columns='item_name', aggfunc='size', fill_value=0)
```

'purchase_month' を縦軸にし、商品毎の売り上げ金額を集計せよ。

```python
join_data.pivot_table(index='purchase_month', columns='item_name', aggfunc='sum', fill_value=0)
```

'purchase_month' を縦軸にし、顧客毎の売り上げ個数を集計をせよ。

```python
join_data.pivot_table(index='purchase_month', columns='顧客名', aggfunc='size', fill_value=0)
```

'purchase_month' を縦軸にし、地域毎の売り上げ個数を集計をせよ。
```python
join_data.pivot_table(index='purchase_month', columns='地域', aggfunc='size', fill_value=0)
```

集計期間内に購入していない顧客を特定せよ。

```python
unpurchased_data = pd.merge(uriage_data, kokyaku_data, left_on='customer_name', right_on='顧客名', how='right')
unpurchased_data[unpurchased_data['purchase_date'].isnull()][['顧客名','メールアドレス']]
```
```
       顧客名                  メールアドレス
2999  福井美希  fukui_miki1@example.com
```
